<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>检验检测行业信息面板 V3.0 - 每日速览</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-6xl">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-6">检验检测行业信息面板 V3.0</h1>
        
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center space-x-2 bg-white px-4 py-2 rounded-full shadow-sm">
                <span class="relative flex h-3 w-3">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500"></span>
                </span>
                <span class="text-gray-600 text-sm">数据最后更新于：<span id="last-updated" class="font-bold text-gray-800">--</span></span>
            </div>
            <p class="text-xs text-gray-400 mt-2">（系统每日早8点自动抓取更新）</p>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                <h2 class="text-xl font-bold text-blue-800 mb-4 border-b pb-2 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path></svg>
                    政策与法规
                </h2>
                <ul id="policy-list" class="space-y-3 min-h-[100px]">
                    <li class="animate-pulse flex space-x-4"><div class="flex-1 space-y-2 py-1"><div class="h-4 bg-gray-200 rounded w-3/4"></div><div class="h-4 bg-gray-200 rounded"></div></div></li>
                </ul>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                <h2 class="text-xl font-bold text-purple-800 mb-4 border-b pb-2 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
                    行业与收并购动态
                </h2>
                <ul id="mergers-list" class="space-y-3 min-h-[100px]">
                    <li class="animate-pulse flex space-x-4"><div class="flex-1 space-y-2 py-1"><div class="h-4 bg-gray-200 rounded w-3/4"></div><div class="h-4 bg-gray-200 rounded"></div></div></li>
                </ul>
            </div>
            
            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow duration-300">
                <h2 class="text-xl font-bold text-orange-800 mb-4 border-b pb-2 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
                    重点上市公司新闻
                </h2>
                
                <div class="space-y-6">
                    <div>
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2 border-l-4 border-blue-500 pl-2">华测检测</h3>
                        <ul id="huace-list" class="space-y-2"><li class="h-2 bg-gray-200 rounded w-full animate-pulse"></li></ul>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2 border-l-4 border-green-500 pl-2">广电计量</h3>
                        <ul id="guangdian-list" class="space-y-2"><li class="h-2 bg-gray-200 rounded w-full animate-pulse"></li></ul>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2 border-l-4 border-purple-500 pl-2">苏试试验</h3>
                        <ul id="sushi-list" class="space-y-2"><li class="h-2 bg-gray-200 rounded w-full animate-pulse"></li></ul>
                    </div>
                    <div>
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2 border-l-4 border-orange-500 pl-2">安车检测</h3>
                        <ul id="anche-list" class="space-y-2"><li class="h-2 bg-gray-200 rounded w-full animate-pulse"></li></ul>
                    </div>
                </div>
            </div>
            
        </div>
        
        <footer class="text-center text-gray-400 mt-12 text-sm">
            <p>© 2025 ResearchBo Dashboard | 每日自动构建</p>
        </footer>
    </div>

    <script>
        // 核心逻辑：直接读取 news_data.json
        // 不再实时请求 Google News，速度提升 100 倍
        
        async function loadData() {
            try {
                // 加载根目录下的 json 文件
                // 添加时间戳防止浏览器缓存旧数据
                const response = await fetch('news_data.json?t=' + new Date().getTime());
                
                if (!response.ok) {
                    throw new Error('找不到数据文件，请检查 GitHub Action 是否成功运行');
                }

                const data = await response.json();
                
                // 1. 更新时间
                document.getElementById('last-updated').textContent = data.update_time;

                // 2. 渲染各板块
                renderList(data.policy, 'policy-list');
                renderList(data.mergers, 'mergers-list');
                
                // 3. 渲染公司
                renderList(data.companies.huace, 'huace-list', true);
                renderList(data.companies.guangdian, 'guangdian-list', true);
                renderList(data.companies.sushi, 'sushi-list', true);
                renderList(data.companies.anche, 'anche-list', true);

            } catch (error) {
                console.error("加载失败:", error);
                document.getElementById('last-updated').innerText = "数据加载失败，请稍后刷新";
                alert("初次部署可能需要等待几分钟，请稍后刷新页面！");
            }
        }

        // 通用渲染函数
        function renderList(items, elementId, isSimple = false) {
            const listEl = document.getElementById(elementId);
            listEl.innerHTML = ''; // 清空骨架屏

            if (!items || items.length === 0) {
                listEl.innerHTML = '<li class="text-gray-400 text-xs italic">暂无今日更新</li>';
                return;
            }

            items.forEach(item => {
                const li = document.createElement('li');
                // 清洗标题中的 HTML 标签 (Google News 有时会带 <b> 标签)
                const cleanTitle = item.title.replace(/<[^>]*>?/gm, '').replace('&nbsp;', ' '); 
                
                if (isSimple) {
                    // 极简模式（用于公司列表）
                    li.innerHTML = `
                        <a href="${item.link}" target="_blank" class="block group">
                            <span class="text-gray-700 text-sm group-hover:text-blue-600 transition-colors line-clamp-1">
                                • ${cleanTitle}
                            </span>
                            <span class="text-xs text-gray-400 pl-3 block">${item.published.split('T')[0] || '今日'}</span>
                        </a>
                    `;
                } else {
                    // 详细模式（用于政策和行业动态）
                    li.innerHTML = `
                        <a href="${item.link}" target="_blank" class="block p-3 rounded-md hover:bg-blue-50 transition-colors border border-transparent hover:border-blue-100 group">
                            <h3 class="font-medium text-gray-800 text-sm mb-1 group-hover:text-blue-700 line-clamp-2">${cleanTitle}</h3>
                            <div class="flex justify-between items-center mt-1">
                                <span class="text-xs text-gray-400 bg-gray-100 px-2 py-0.5 rounded">${item.published.split('T')[0] || 'News'}</span>
                                <span class="text-xs text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity">点击阅读 &rarr;</span>
                            </div>
                        </a>
                    `;
                }
                listEl.appendChild(li);
            });
        }

        // 页面加载后立即执行
        window.addEventListener('DOMContentLoaded', loadData);
    </script>
</body>
</html>
